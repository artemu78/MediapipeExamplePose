import{DrawingUtils as p,FilesetResolver as I,PoseLandmarker as g}from"https://cdn.skypack.dev/@mediapipe/tasks-vision@0.10.0";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function o(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(e){if(e.ep)return;e.ep=!0;const n=o(e);fetch(e.href,n)}})();const L=document.getElementById("demos");let i,l="IMAGE",f,m=!1;const w="360px",E="480px",k=async()=>{const t=await I.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.0/wasm");i=await g.createFromOptions(t,{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/pose_landmarker/pose_landmarker_lite/float16/1/pose_landmarker_lite.task",delegate:"GPU"},runningMode:l,numPoses:2}),L.classList.remove("invisible")};k();const v=document.getElementsByClassName("detectOnClick");for(let t=0;t<v.length;t++)v[t].children[0].addEventListener("click",N);async function N(t){if(!i){console.log("Wait for poseLandmarker to load before clicking!");return}l==="VIDEO"&&(l="IMAGE",await i.setOptions({runningMode:"IMAGE"}));const r=t.target.parentNode.getElementsByClassName("canvas");for(var o=r.length-1;o>=0;o--){const s=r[o];s.parentNode.removeChild(s)}i.detect(t.target,s=>{const e=document.createElement("canvas");e.setAttribute("class","canvas"),e.setAttribute("width",t.target.naturalWidth+"px"),e.setAttribute("height",t.target.naturalHeight+"px"),e.style="left: 0px;top: 0px;width: "+t.target.width+"px;height: "+t.target.height+"px;",t.target.parentNode.appendChild(e);const n=e.getContext("2d"),d=new p(n);for(const h of s.landmarks)d.drawLandmarks(h,{radius:b=>p.lerp(b.from.z,-.15,.1,5,1)}),d.drawConnectors(h,g.POSE_CONNECTIONS)})}const a=document.getElementById("webcam"),c=document.getElementById("output_canvas"),u=c.getContext("2d"),y=new p(u),x=()=>{var t;return!!((t=navigator.mediaDevices)!=null&&t.getUserMedia)};x()?(f=document.getElementById("webcamButton"),f.addEventListener("click",M)):console.warn("getUserMedia() is not supported by your browser");function M(t){if(!i){console.log("Wait! poseLandmaker not loaded yet.");return}m===!0?(m=!1,f.innerText="ENABLE PREDICTIONS"):(m=!0,f.innerText="DISABLE PREDICTIONS");const r={video:!0};navigator.mediaDevices.getUserMedia(r).then(o=>{a.srcObject=o,a.addEventListener("loadeddata",C)})}let O=-1;async function C(){c.style.height=w,a.style.height=w,c.style.width=E,a.style.width=E,l==="IMAGE"&&(l="VIDEO",await i.setOptions({runningMode:"VIDEO"}));let t=performance.now();O!==a.currentTime&&(O=a.currentTime,i.detectForVideo(a,t,r=>{u.save(),u.clearRect(0,0,c.width,c.height);for(const o of r.landmarks)y.drawLandmarks(o,{radius:s=>p.lerp(s.from.z,-.15,.1,5,1)}),y.drawConnectors(o,g.POSE_CONNECTIONS);u.restore()})),m===!0&&window.requestAnimationFrame(C)}
